FROM mcr.microsoft.com/dotnet/sdk:7.0

WORKDIR /source
COPY . .

RUN dotnet new tool-manifest || true
RUN dotnet tool install dotnet-reportgenerator-globaltool

RUN dotnet test src/Hive.Domain.Tests -c Test /p:CollectCoverage=true  /p:CoverletOutputFormat=opencover /p:SkipAutoProps=true
RUN dotnet reportgenerator "-reports:src/Hive.Domain.Tests/coverage.opencover.xml" "-targetdir:./domain-coverage" -reporttypes:Html
